<html lang="en" xmlns:th="http://www.thymeleaf.org"><head>
    <style type="text/css">
        .c202304211238582 {

        }
        .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px;
        }

        /*.left4 {*/
        /*    width: 200px;*/
        /*    height: 200px;*/
        /*    border: 4px solid #ddd;*/
        /*    box-sizing: border-box;*/
        /*    background-color: #f1f1f1;*/
        /*    display: flex;*/
        /*    flex-direction: column;*/
        /*    justify-content: center;*/
        /*    align-items: center;*/
        /*}*/

        /*.left4 input {*/
        /*    display: none;*/
        /*}*/

        /*.left4 label {*/
        /*    cursor: pointer;*/
        /*    position: absolute;*/
        /*}*/

        /*.left4 i {*/
        /*    font-size: 200px;*/
        /*    color: #8a8a8a;*/
        /*}*/

        /*.left4 p {*/
        /*    font-size: 20px;*/
        /*    color: #8a8a8a;*/
        /*    text-align: center;*/
        /*}*/
        .center {
            width: 200px;
            height: 200px;
            border: 4px solid #ddd;
            box-sizing: border-box;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-right: 30px; /* 保留原有的右侧间距 */
            margin-left: 30px; /* 保留原有的右侧间距 */
        }
        .center input {
            display: none;
        }

        .center label {
            cursor: pointer;
            position: absolute;
        }

        .center i {
            font-size: 200px;
            color: #8a8a8a;
        }

        .center p {
            font-size: 20px;
            color: #8a8a8a;
            text-align: center;
        }
        /*.center img {*/
        /*    width: 100%;*/
        /*    height: 100%;*/
        /*    object-fit: cover; !* 修改为contain *!*/
        /*    display: none;*/
        /*}*/

        .center1 {
            width: 200px;
            height: 200px;
            border: 4px solid #ddd;
            box-sizing: border-box;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-right: 30px; /* 保留原有的右侧间距 */
            margin-left: 30px; /* 保留原有的右侧间距 */
        }

        .center1 img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 修改为contain */
            display: none;
        }
        .center2 {
            width: 200px;
            height: 200px;
            border: 4px solid #ddd;
            box-sizing: border-box;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-right: 30px; /* 保留原有的右侧间距 */
            margin-left: 30px; /* 保留原有的右侧间距 */
        }

        .center2 img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 修改为contain */
            display: none;
        }
        .center3 {
            width: 200px;
            height: 200px;
            border: 4px solid #ddd;
            box-sizing: border-box;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-right: 30px; /* 保留原有的右侧间距 */
            margin-left: 30px; /* 保留原有的右侧间距 */
        }

        .center3 img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 修改为contain */
            display: none;
        }

        .right4 {
            width: 200px;
            height: 200px;
            border: 4px solid #ddd;
            box-sizing: border-box;
            background-color: #f1f1f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .right4 img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 修改为contain */
            display: none;
        }


        #choose {
            width: 150px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            margin-top: 20px;
            margin-left: 130px;
            text-align: center;
            line-height: 40px;
        }

        #upload4 {
            width: 150px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            margin-top: 20px;
            margin-left: 150px;
        }

        .loader4 {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 16px solid #f3f3f3;
            border-radius: 50%;
            border-top: 16px solid #3498db;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
        }
        #delete4 {
            width: 150px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            margin-top: 20px;
            margin-left: 200px;

        }
        /* 隐藏模态框 */
        #modal4 {
            display: none; /* 初始状态隐藏 */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        /* 模态框内容 */
        #modal4-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 70%;
            max-height: 70%;
            transition: transform 1s; /* 将过渡时间从0.2秒增加到1秒 */
        }

        /* 图片 */
        #modal4-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .textContainer {
            display: flex;
            justify-content: space-between; /* 这会使得两个 p 标签在水平方向上均匀分布 */
        }
        .textOne {
            width: 100px;
            height: 0px;
            font-size: 20px;
            text-align: left;
            color: #000;
            font-weight: bold;
        }
        .textTwo {
            width: 100px;
            font-size: 20px;
            text-align: left;
            height: 0px;
            color: #000;
            font-weight: bold;
        }
    </style>
    <div id="loader4" class="loader4" style="display: none;"></div>
    <script type="text/javascript">
        $(document).ready(function () {
            //选择图片文件
            $("#file4").change(function () {
                var file4 = this.files[0];
                if (file4) {
                    //显示图片预览
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $("#fileNameDisplay4").val(file4.name);
                        // $("#img2").attr("src", e.target.img1);
                        // $("#img2").css("width", "400px"); //添加这一行，让图片大小和点击上传区域一样大
                        // $("#img2").css("height", "400px"); //添加这一行，让图片大小和点击上传区域一样大
                        //$("#img2").css("object-fit", "cover"); //添加这一行，让图片自动填充
                        //启用删除按钮
                        $("#delete4").prop("disabled", false);
                    };
                    reader.readAsDataURL(file4);
                }
            });
            // // 加载OBJ和MTL文件的函数
            // function loadOBJMTLData(objData, mtlData, imgID) {
            //     // 创建OBJ加载器和MTL加载器
            //     var objLoader = new THREE.OBJLoader();
            //     var mtlLoader = new THREE.MTLLoader();
            //
            //     // 将数据转换为Blob对象
            //     var objBlob = new Blob([objData], { type: "text/plain" });
            //     var mtlBlob = new Blob([mtlData], { type: "text/plain" });
            //
            //     // 加载MTL文件
            //     mtlLoader.parse(mtlBlob, null, function (materials) {
            //         // 将加载的材质应用到OBJ加载器
            //         objLoader.setMaterials(materials);
            //
            //         // 加载OBJ文件
            //         objLoader.parse(objBlob, null, function (object) {
            //             // 获取OBJ文件中的第一个对象并添加到场景中
            //             var imgElement = document.getElementById(imgID);
            //             imgElement.src = object.children[0].material.map.image.src;
            //             imgElement.style.display = "block"; // 显示图片
            //         });
            //     });
            // }
            //点击上传按钮
            $("#upload4").click(function () {
                var file4 = $("#file4")[0].files[0];
                if (file4) {
                    //禁用上传按钮
                    $("#upload4").prop("disabled", true);
                    //显示加载动画
                    $("#loader4").show();

                    //创建 FileReader 对象
                    var reader4 = new FileReader();
                    reader4.onload = function(e) {
                        //发送post请求
                        $.ajax({
                            url: "http://175.178.128.43:39222/files", //这里是你的后端接口地址
                            type: "POST",
                            data: JSON.stringify({ files: e.target.result }), // 将图像数据编码成 base64 格式
                            contentType: 'application/json',
                            processData: false,
                            success: function (data) {
                                console.log('接收到的数据:', data);
                                //隐藏加载动画
                                $("#loader4").hide();
                                //启用上传按钮
                                $("#upload4").prop("disabled", false);


                                //显示返回的图片
                                $("#img1").attr("src", 'data:image/png;base64,' + data.image1).show();
                                $("#img2").attr("src", 'data:image/png;base64,' + data.image2).show();
                                $("#img3").attr("src", 'data:image/png;base64,' + data.image3).show();
                                $("#img4").attr("src", 'data:image/png;base64,' + data.image4).show();
                                $("#img5").attr("src", 'data:image/png;base64,' + data.image5).show();
                                //加载OBJ和MTL文件数据
                                //接受3D_obj格式文件
                                // 成功接收到数据后的处理逻辑
                                var objContent = data.Zobj_3D; // 获取 OBJ 文件内容
                                var mtlContent = data.Zmtl_3D; // 获取 MTL 文件内容
                                //loadOBJMTLData(objContent, mtlContent, "img5");
                                //启用删除按钮
                                $("#delete4").prop("disabled", false);
                            },
                            error: function (xhr, status, error) {
                                //隐藏加载动画
                                $("#loader4").hide();
                                //启用删除按钮
                                $("#delete4").prop("disabled", false);
                                //启用上传按钮
                                $("#upload4").prop("disabled", false);
                                //显示错误信息
                                alert("上传失败：" + error);
                            }
                        });
                    };
                    reader4.readAsDataURL(file4); // 以 base64 格式读取文件数据
                } else {
                    //提示选择图片
                    alert("请先选择图片文件");
                }
            });


            $("#delete4").click(function () {
                //清空文件输入框
                $("#file4").val("");
                // 清空文件名显示框
                $("#fileNameDisplay4").val("");
                //禁用删除按钮
                $("#delete4").prop("disabled", true);

                //清空预览图片和结果图片
                $("#img1").attr("src", "");
                $("#img2").attr("src", "");
                $("#img3").attr("src", "");
                $("#img4").attr("src", "");
                $("#img5").attr("src", "");
                $("#img1").hide();
                $("#img2").hide();
                $("#img3").hide();
                $("#img4").hide();
                $("#img5").hide();
                $("#label").show();

            });
            // 当点击图片时，显示模态框
            $("#img1").click(function() {
                $("#modal4-img").attr("src", $(this).attr("src"));
                $("#modal4").show();
            });
            // 当点击图片时，显示模态框
            $("#img2").click(function() {
                $("#modal4-img").attr("src", $(this).attr("src"));
                $("#modal4").show();
            });
            // 当点击图片时，显示模态框
            $("#img3").click(function() {
                $("#modal4-img").attr("src", $(this).attr("src"));
                $("#modal4").show();
            });
            // 当点击图片时，显示模态框
            $("#img4").click(function() {
                $("#modal4-img").attr("src", $(this).attr("src"));
                $("#modal4").show();
            });
            // 当点击图片时，显示模态框
            $("#img5").click(function() {
                $("#modal4-img").attr("src", $(this).attr("src"));
                $("#modal4").show();
            });
            // 当点击模态框外部时，隐藏模态框
            $("#modal4").click(function(event) {
                if (event.target == this) {
                    $(this).hide();
                }
            });
            // 当滚动鼠标滚轮时，放大或缩小图片
            $("#modal4-content").on("wheel", function(event) {
                event.preventDefault();

                var scale = 1 + event.originalEvent.deltaY * -0.007;

                // 限制缩放比例在0.1到1之间
                scale = Math.min(Math.max(.1, scale), 1);

                $(this).css("transform", "translate(-50%, -50%) scale(" + scale + ")");

                // 显示缩放比例
                $("#scale").text("缩放比例: " + Math.round(scale * 100) + "%");
            });
        });

    </script>

</head>
<body>
<div id="m202304211238582" class="c202304211238582 own-page-index">


    <div class="container">
<!--        <div class="left4">-->
<!--            <img id="img2" src="" alt="" style="width: 200px; height: 200px;">-->
<!--            <div id="modal4">-->
<!--                <div id="modal4-content">-->
<!--                    <img id="modal4-img" src="" alt="">-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
        <div class="center">
            <img id="img1" src="" alt="" style="width: 200px; height: 200px;">
            <div id="modal4">
                <div id="modal4-content">
                    <img id="modal4-img" src="" alt="">
                </div>
            </div>
        </div>
        <div class="center1">
            <img id="img2" src="" alt="" style="width: 200px; height: 200px;">
        </div>
        <div class="center2">
            <img id="img3" src="" alt="" style="width: 200px; height: 200px;">
        </div>
        <div class="center3">
            <img id="img4" src="" alt="" style="width: 200px; height: 200px;">
        </div>
        <div class="right4">
            <img id="img5" src="" alt="" style="width: 200px; height: 200px;">
        </div>
    </div>
    <!--    <div class="textContainer">-->
    <!--        <p class="textOne">原图像</p>-->
    <!--        <p class="textTwo">特征提取</p>-->
    <!--    </div>-->

    <div class="button-container">
        <!-- 使用label元素关联文件输入框 -->
        <label for="file4" class="button" id="choose">选择文件</label>
        <input type="file" id="file4" accept=".nii.gz" style="display: none;">
        <input type="text" id="fileNameDisplay4" readonly style="width: 100px;">
        <button id="upload4" class="button">智能分析</button>
        <button id="delete4" class="button" disabled>清除结果</button>

    </div>



</div>
</body>
</html>
